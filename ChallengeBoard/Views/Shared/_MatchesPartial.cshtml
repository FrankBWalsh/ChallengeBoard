@model IEnumerable<ChallengeBoard.Models.Match>
<table class="table table-striped table-bordered no-more-tables sortedTable">
    <thead>
        <tr>
            <th class="span2">
                @Html.DisplayNameFor(m => m.Winner)
            </th>
            <th class="centered span1">
                @Html.DisplayNameFor(m => m.WinnerEstimatedRating)
            </th>
            <th class="span2">
                @Html.DisplayNameFor(m => m.Loser)
            </th>
            <th class="centered span1">
                @Html.DisplayNameFor(m => m.LoserEstimatedRating)
            </th>
            <th class="span2">Match Result
            </th>
            <th class="centered span2">
                @Html.DisplayNameFor(m => m.Created)
            </th>
            <th class="centered span2">
                @if (Model.Any(m => m.IsResolved))
                {
                    @:Resolved On
                }
                else
                {
                    @:Auto&nbsp;Verifies
                }
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var match in Model)
        {
            <tr>
                <td data-title="@Html.DisplayNameFor(m => m.Winner)">
                    <span class="label label-success eloChange" >
                        @if(match.WinnerRatingDelta >= 0){@Html.Raw("+")}@Html.DisplayFor(modelItem => match.WinnerRatingDelta)
                    </span>
                    - 
                    @Html.ActionLink(match.Winner.Name, "Profile", "Competitors", new { boardId = match.Board.BoardId, competitorId = match.Winner.CompetitorId }, null)
                    @if (!String.IsNullOrWhiteSpace(match.WinnerComment))
                    {
                        <a href="#" rel="popover" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="top" data-original-title="@match.Winner.Name's comments..." data-content="@match.WinnerComment"><i class="icon-comment icon-grey"></i></a>
                    }
                </td>
                <td class="centered" data-title="@Html.DisplayNameFor(m => m.WinnerEstimatedRating)">
                    @if (match.WinnerEstimatedRating == 0)
                    {
                        @:N/A
                    }
                    else
                    {
                        @Html.DisplayFor(modelItem => match.WinnerEstimatedRating)
                    }
                </td>
                <td data-title="@Html.DisplayNameFor(m => m.Loser)"> 
                    <span class="label label-info eloChange">
                        @if(match.LoserRatingDelta >= 0){@Html.Raw("+")}@Html.DisplayFor(modelItem => match.LoserRatingDelta)
                    </span>
                    - 
                    @Html.ActionLink(match.Loser.Name, "Profile", "Competitors", new { boardId = match.Board.BoardId, competitorId = match.Loser.CompetitorId }, null)
                </td>
                <td class="centered" data-title="@Html.DisplayNameFor(m => m.LoserEstimatedRating)">
                    @if (match.LoserEstimatedRating == 0)
                    {
                        @:N/A
                    }
                    else
                    {
                        @Html.DisplayFor(modelItem => match.LoserEstimatedRating)
                    }
                </td>
                <td data-title="Result">
                    @if (match.Rejected)
                    {
                        <span class="label label-important">
                            Match rejected.
                        </span>
                    }
                    else if (match.Tied)
                    {
                        @: Tie match.
                    }
                    else
                    {
                        @: Reporter wins.
                    }
                </td>
                <td class="centered"  data-title="@Html.DisplayNameFor(m => m.Created)">
                    @Html.DisplayFor(modelItem => match.Created)
                </td>
            
                @if (match.IsResolved)
                {
                    <td class="centered" data-title="Resolved">
                        @if (match.Resolved.HasValue)
                        {
                            @Html.DisplayFor(modelItem => match.Resolved)
                        }
                    </td>
                }       
                else
                {
                    <td class="commands" data-title="Auto Verifies">
                        @{
                            var diff = match.VerificationDeadline.Subtract(DateTime.Now);
                            var remaining = "moments";

                            if (diff.TotalHours >= 1)
                            {
                                remaining = Math.Round(diff.TotalHours,0) + "hr";
                            }
                            else if (diff.Minutes >= 1)
                            {
                                remaining = diff.Minutes + "min";
                            }
                        }
                        @if (match.Loser.Name.Equals(User.Identity.Name, StringComparison.OrdinalIgnoreCase))
                        {
                            <ul class="nav nav-pills">
                                <li>
                                    @Html.ActionLink(remaining, "Validate", new { id = match.Board.BoardId, matchId = match.MatchId },
                                                     new
                                                     {
                                                         @class = "validate", title = "Reject Match", 
                                                         data_winner = match.Winner.Name, 
                                                         data_winnerRatingDelta = match.WinnerRatingDelta,
                                                         data_loser = match.Loser.Name, 
                                                         data_loserRatingDelta = match.LoserRatingDelta,
                                                         data_matchId = match.MatchId, 
                                                         data_boardId = match.Board.BoardId
                                                     })
                                </li>
                            </ul>
                        }
                        else
                        {
                            @remaining
                        }
                    </td>
                }
            </tr>
        }
    </tbody>
</table>